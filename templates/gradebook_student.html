{% include 'header.html' %}
<body>
    {% include 'top_menus.html' %}
    
    <div class="container mx-auto px-4 py-8">
        <!-- Animated Background -->
        <div class="fixed inset-0 overflow-hidden pointer-events-none">
            <div class="absolute -top-40 -right-40 w-80 h-80 bg-green-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
            <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-blue-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse delay-1000"></div>
        </div>
        
        <!-- Header Section -->
        <div class="relative z-10 mb-8 animate__animated animate__fadeInDown">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold gradient-text mb-2">
                        <i class="fas fa-chart-line mr-3"></i>My Grades
                    </h1>
                    <p class="text-gray-600">Track your academic performance and progress</p>
                </div>
                
                <!-- Download Report -->
                <button class="ripple bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-3 rounded-lg font-medium hover:from-green-700 hover:to-emerald-700 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center group">
                    <i class="fas fa-download mr-2 group-hover:scale-110 transition-transform duration-300"></i>
                    Download Report
                </button>
            </div>
            
            <!-- Performance Summary -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
                <div class="bg-white rounded-xl p-4 shadow-lg hover-lift">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-tasks text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Total Assignments</p>
                            <p class="text-2xl font-bold">{{ total_assignments }}</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 shadow-lg hover-lift">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Submitted</p>
                            <p class="text-2xl font-bold">{{ submitted_assignments }}</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 shadow-lg hover-lift">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-star text-yellow-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Average Score</p>
                            <p class="text-2xl font-bold">{{ avg_percentage }}%</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 shadow-lg hover-lift">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-graduation-cap text-purple-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Overall Grade</p>
                            <p class="text-2xl font-bold">{{ avg_percentage|letter_grade }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Performance Chart -->
        <div class="relative z-10 bg-white rounded-2xl shadow-xl p-6 mb-6 animate__animated animate__fadeInUp">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold gradient-text">Performance Overview</h2>
                <select class="px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                    <option>This Semester</option>
                    <option>Last Semester</option>
                    <option>All Time</option>
                </select>
            </div>
            
            <!-- Chart Placeholder -->
            <div class="h-64 flex items-center justify-center bg-gradient-to-r from-gray-50 to-white rounded-xl">
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-blue-100 flex items-center justify-center">
                        <i class="fas fa-chart-bar text-blue-600 text-2xl"></i>
                    </div>
                    <p class="text-gray-600">Performance chart will appear here</p>
                    <p class="text-sm text-gray-500">(Interactive chart integration coming soon)</p>
                </div>
            </div>
        </div>
        
        <!-- Grades Table -->
        <div class="relative z-10 bg-white rounded-2xl shadow-xl overflow-hidden animate__animated animate__fadeInUp">
            <!-- Table Header -->
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold text-gray-800">Detailed Grades</h2>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <input type="text" placeholder="Search grades..." 
                                   class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <button class="text-gray-600 hover:text-blue-600 transition-colors duration-300">
                            <i class="fas fa-filter"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Course
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Assignment
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Max Marks
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Obtained
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Percentage
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Grade
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Status
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for grade in grades %}
                        <tr class="hover:bg-blue-50 transition-colors duration-200 animate-on-scroll" style="animation-delay: {{ loop.index0 * 50 }}ms">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold mr-3">
                                        {{ grade.course_name[0] }}
                                    </div>
                                    <div>
                                        <div class="font-medium text-gray-900">{{ grade.course_name }}</div>
                                        <div class="text-sm text-gray-500">Course Average: {{ grade.course_avg }}%</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="font-medium text-gray-900">{{ grade.assignment_title }}</div>
                                <div class="text-sm text-gray-500">{{ grade.submission_date|dateformat if grade.submission_date else 'Not submitted' }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-gray-900 font-medium">{{ grade.max_marks }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-gray-900 font-medium">
                                    {% if grade.marks_obtained is not none %}
                                    {{ grade.marks_obtained }}
                                    {% else %}
                                    <span class="text-gray-400">-</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="w-16 bg-gray-200 rounded-full h-2 mr-3">
                                        {% if grade.percentage is not none %}
                                        <div class="h-2 rounded-full {% if grade.percentage >= 90 %}bg-green-500
                                            {% elif grade.percentage >= 80 %}bg-blue-500
                                            {% elif grade.percentage >= 70 %}bg-yellow-500
                                            {% elif grade.percentage >= 60 %}bg-orange-500
                                            {% else %}bg-red-500{% endif %}" 
                                            style="width: {{ grade.percentage }}%"></div>
                                        {% endif %}
                                    </div>
                                    <span class="font-medium {% if grade.percentage is not none %}
                                        {% if grade.percentage >= 90 %}text-green-600
                                        {% elif grade.percentage >= 80 %}text-blue-600
                                        {% elif grade.percentage >= 70 %}text-yellow-600
                                        {% elif grade.percentage >= 60 %}text-orange-600
                                        {% else %}text-red-600{% endif %}
                                        {% else %}text-gray-400{% endif %}">
                                        {% if grade.percentage is not none %}{{ grade.percentage }}%{% else %}-{% endif %}
                                    </span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-3 py-1 rounded-full text-sm font-medium 
                                    {% if grade.grade == 'A+' or grade.grade == 'A' %}bg-green-100 text-green-800
                                    {% elif grade.grade == 'B' %}bg-blue-100 text-blue-800
                                    {% elif grade.grade == 'C' %}bg-yellow-100 text-yellow-800
                                    {% elif grade.grade == 'D' %}bg-orange-100 text-orange-800
                                    {% else %}bg-red-100 text-red-800{% endif %}">
                                    {{ grade.grade if grade.grade else 'N/A' }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    {% if grade.marks_obtained is not none %}
                                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-check-circle mr-1"></i>Graded
                                    </span>
                                    {% elif grade.submission_date %}
                                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        <i class="fas fa-clock mr-1"></i>Pending
                                    </span>
                                    {% else %}
                                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        <i class="fas fa-times-circle mr-1"></i>Missing
                                    </span>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Table Footer -->
            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-700">
                        Showing <span class="font-bold">{{ grades|length }}</span> grades
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="ripple w-10 h-10 rounded-lg border border-gray-300 flex items-center justify-center hover:bg-gray-100 transition-colors duration-300">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="ripple w-10 h-10 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white flex items-center justify-center hover:from-blue-700 hover:to-purple-700 transition-all duration-300">
                            1
                        </button>
                        <button class="ripple w-10 h-10 rounded-lg border border-gray-300 flex items-center justify-center hover:bg-gray-100 transition-colors duration-300">
                            2
                        </button>
                        <button class="ripple w-10 h-10 rounded-lg border border-gray-300 flex items-center justify-center hover:bg-gray-100 transition-colors duration-300">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Grade Distribution -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <!-- Grade Statistics -->
            <div class="bg-white rounded-2xl shadow-xl p-6 animate__animated animate__fadeInLeft">
                <h3 class="text-xl font-bold mb-4 gradient-text">Grade Distribution</h3>
                <div class="space-y-4">
                    {% set grade_counts = {
                        'A+': grades|selectattr('grade', 'equalto', 'A+')|list|length,
                        'A': grades|selectattr('grade', 'equalto', 'A')|list|length,
                        'B': grades|selectattr('grade', 'equalto', 'B')|list|length,
                        'C': grades|selectattr('grade', 'equalto', 'C')|list|length,
                        'D': grades|selectattr('grade', 'equalto', 'D')|list|length,
                        'F': grades|selectattr('grade', 'equalto', 'F')|list|length
                    } %}
                    
                    {% for grade, count in grade_counts.items() %}
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="font-medium">{{ grade }}</span>
                            <span class="text-gray-600">{{ count }} assignments</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            {% set percentage = (count / grades|length * 100) if grades|length > 0 else 0 %}
                            <div class="h-2 rounded-full progress-fill 
                                {% if grade == 'A+' or grade == 'A' %}bg-green-500
                                {% elif grade == 'B' %}bg-blue-500
                                {% elif grade == 'C' %}bg-yellow-500
                                {% elif grade == 'D' %}bg-orange-500
                                {% else %}bg-red-500{% endif %}" 
                                style="width: {{ percentage }}%"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Performance Tips -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-6 text-white shadow-xl animate__animated animate__fadeInRight">
                <h3 class="text-xl font-bold mb-4">Performance Tips</h3>
                <div class="space-y-4">
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div>
                            <p class="font-medium">Submit assignments on time</p>
                            <p class="text-blue-100 text-sm">Late submissions often result in grade deductions</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <p class="font-medium">Track your progress</p>
                            <p class="text-blue-100 text-sm">Regularly check grades to identify areas for improvement</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div>
                            <p class="font-medium">Seek feedback</p>
                            <p class="text-blue-100 text-sm">Review instructor comments to understand mistakes</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <p class="font-medium">Plan ahead</p>
                            <p class="text-blue-100 text-sm">Use calendar to track assignment due dates</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Progress bar animations
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach((bar, index) => {
                const width = bar.style.width;
                bar.style.width = '0';
                setTimeout(() => {
                    bar.style.width = width;
                    bar.style.transition = 'width 1s ease-out';
                }, 300 + (index * 100));
            });
            
            // Table row animations
            const tableRows = document.querySelectorAll('tbody tr');
            tableRows.forEach((row, index) => {
                row.style.opacity = '0';
                row.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    row.style.opacity = '1';
                    row.style.transform = 'translateY(0)';
                    row.style.transition = 'all 0.5s ease-out';
                }, 100 + (index * 50));
            });
            
            // Grade distribution visualization
            const gradeColors = {
                'A+': '#10b981',
                'A': '#34d399',
                'B': '#3b82f6',
                'C': '#f59e0b',
                'D': '#f97316',
                'F': '#ef4444'
            };
            
            // Add hover effects to table rows
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(10px)';
                    this.style.transition = 'transform 0.3s ease';
                });
                
                row.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateX(0)';
                });
            });
            
            // Download report button animation
            const downloadBtn = document.querySelector('.fa-download').closest('button');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', function() {
                    const originalHTML = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Generating...';
                    this.disabled = true;
                    
                    // Simulate download process
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-check mr-2"></i> Report Ready!';
                        
                        setTimeout(() => {
                            this.innerHTML = originalHTML;
                            this.disabled = false;
                            
                            // Show success message
                            showToast('Report downloaded successfully!', 'success');
                        }, 1500);
                    }, 2000);
                });
            }
        });
        
        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-xl text-white z-50 transform translate-x-full transition-transform duration-300 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
            }`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-3"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Search functionality
        const searchInput = document.querySelector('input[placeholder="Search grades..."]');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
        }
        
        // Filter by grade
        function filterByGrade(grade) {
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const gradeCell = row.querySelector('.px-3.py-1.rounded-full');
                if (gradeCell) {
                    const hasGrade = gradeCell.textContent.includes(grade);
                    row.style.display = grade === 'all' || hasGrade ? '' : 'none';
                }
            });
        }
    </script>
</body>
</html>